{% comment %}
  Renders a product in list view format

  Accepts:
  - product: {Object} Product object

  Usage:
  {% render 'product-list-item', product: product %}
{% endcomment %}

{%- liquid
  assign image = product.selected_or_first_available_variant.featured_image | default: product.featured_media
  assign has_mockup = false
  assign mockup_type = product.metafields.custom.mockup_type

  if settings.enable_mockup_compositing and settings.mockup_base_url != blank and mockup_type != blank
    assign has_mockup = true
  endif

  assign preorder = false
  for tag in product.tags
    if tag contains 'preorder'
      assign preorder = true
    endif
  endfor
-%}

<div class="product-list-item d-flex align-items-center py-3 border-bottom">
  {%- comment -%} Product Image {%- endcomment -%}
  <div class="product-list-item__image-wrapper flex-shrink-0">
    <a href="{{ product.url | within: collection }}" class="product-list-item__image-link">
      {%- if has_mockup -%}
        <canvas class="product-list-item__image mockup-canvas lazyload"
                data-mockup-type="{{ mockup_type }}"
                data-product-image="{{ image | image_url: width: 150 }}"
                data-sizes="auto"
                data-aspectratio="{{ image.aspect_ratio }}"
                width="80"
                height="80">
        </canvas>
      {%- elsif image -%}
        <img
          src="{{ image | image_url: width: 80 }}"
          srcset="{{ image | image_url: width: 80 }} 1x, {{ image | image_url: width: 160 }} 2x"
          alt="{{ image.alt | escape }}"
          class="product-list-item__image lazyload"
          loading="lazy"
          width="80"
          height="80"
        >
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'product-list-item__image placeholder-svg' }}
      {%- endif -%}
    </a>
  </div>

  {%- comment -%} Product Title {%- endcomment -%}
  <div class="product-list-item__title-wrapper flex-grow-1 px-3">
    <h3 class="product-list-item__title h5 m-0">
      <a href="{{ product.url | within: collection }}" class="text-body">
        {{ product.title | escape }}
      </a>
    </h3>
  </div>

  {%- comment -%} Product Type {%- endcomment -%}
  <div class="product-list-item__type-wrapper flex-shrink-0 px-3">
    {%- if product.type != blank -%}
      <span class="product-list-item__type text-body small">{{ product.type }}</span>
    {%- else -%}
      <span class="product-list-item__type text-body small">â€”</span>
    {%- endif -%}
  </div>

  {%- comment -%} Product Price {%- endcomment -%}
  <div class="product-list-item__price-wrapper flex-shrink-0 px-3">
    <div class="product-list-item__price {% if product.compare_at_price > product.price %}product-list-item__price--sale{% endif %}">
      {%- if product.compare_at_price > product.price -%}
        {%- if product.price_varies -%}
          {%- assign sale_price = product.price | money -%}
          <span class="product-list-item__price-current">{{ 'products.product.on_sale_from_html' | t: price: sale_price }}</span>
        {%- else -%}
          <span class="product-list-item__price-current">{{ product.price | money }}</span>
          <s class="product-list-item__price-regular small ml-2">{{ product.compare_at_price | money }}</s>
        {%- endif -%}
      {%- else -%}
        {%- if product.price_varies -%}
          {%- assign price = product.price | money -%}
          <span class="product-list-item__price-current">{{ 'products.product.from_text_html' | t: price: price }}</span>
        {%- else -%}
          <span class="product-list-item__price-current">{{ product.price | money }}</span>
        {%- endif -%}
      {%- endif -%}
    </div>
  </div>

  {%- comment -%} Product Actions {%- endcomment -%}
  <div class="product-list-item__actions d-flex align-items-center gap-2 flex-shrink-0 pl-3">
    {%- if settings.enable_wishlsit -%}
      <button
        type="button"
        class="btn btn-theme gradient-theme-vertical product-list-item__action-btn js-btn-wishlist"
        data-toggle="tooltip"
        data-placement="top"
        data-tooltipalltimes="true"
        title="{{ 'products.product.wishlist_text' | t }}"
        data-handle="{{ product.handle }}">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16.2936 3C14.0394 3 12.5436 4.38469 11.7505 5.39062C10.9593 4.38328 9.46161 3 7.2074 3C4.36583 3 2.03005 5.36906 2.00052 8.28047C1.97521 10.8216 2.8738 13.1681 4.74786 15.4523C5.62771 16.5248 7.22286 18.2395 10.9068 20.7403C11.1552 20.9106 11.4493 21.0017 11.7505 21.0017C12.0517 21.0017 12.3458 20.9106 12.5943 20.7403C16.2782 18.2395 17.8733 16.5248 18.7532 15.4523C20.6282 13.1677 21.5258 10.8211 21.5005 8.28047C21.471 5.36906 19.1352 3 16.2936 3Z" fill="currentColor"></path>
        </svg>
        <span class="visually-hidden">{{ 'products.product.wishlist_text' | t }}</span>
      </button>
    {%- endif -%}

    {%- if settings.enable_compare -%}
      <button
        type="button"
        class="btn btn-theme gradient-theme-vertical product-list-item__action-btn js-btn-compare"
        data-tooltip="true"
        data-placement="top"
        title="{{ 'products.product.compare_text' | t }}"
        data-handle="{{ product.handle }}">
        <svg class="icon-add-compare" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14.1 4L19.5 7.80002L14.1 12M18.2506 7.80002H4M10 20L4.5 16.2L10 12M5.7875 16.2H20.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <svg focusable="false" class="icon icon-remove" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 18L6 6M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        <span class="visually-hidden">{{ 'products.product.compare_text' | t }}</span>
      </button>
    {%- endif -%}

    <button
      type="button"
      class="btn btn-theme gradient-theme-vertical product-list-item__action-btn js-grid-cart {% unless product.available %}disabled{% endunless %}"
      data-tooltip="true"
      data-placement="top"
      {% if product.available %}
        title="{{ 'products.product.add_to_cart' | t }}"
      {% else %}
        title="{{ 'products.product.sold_out' | t }}"
      {% endif %}
      data-id="{{ product.selected_or_first_available_variant.id }}">
      <svg class="svg-cart" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M17.5727 7.45459H6.42926C5.47205 7.45459 4.67878 8.19674 4.61511 9.15183L3.94845 19.1519C3.87848 20.2012 4.71085 21.091 5.76259 21.091H18.2393C19.2912 21.091 20.1235 20.2012 20.0535 19.1519L19.3869 9.15183C19.3232 8.19674 18.5299 7.45459 17.5727 7.45459Z" stroke="currentColor" stroke-width="1.5"></path>
        <path d="M15.638 10.1818V6.54542C15.638 4.53711 14.0099 2.90906 12.0016 2.90906C9.99329 2.90906 8.36523 4.53711 8.36523 6.54542V10.1818" stroke="currentColor" stroke-width="1.5" stroke-linecap="square"></path>
      </svg>
      <div class="product-list-item__loading spinner-border" role="status"></div>
      <span class="visually-hidden">
        {% unless product.available %}
          {{ 'products.product.sold_out' | t }}
        {% else %}
          {%- if preorder == true -%}
            {{ 'products.product.pre_order' | t }}
          {%- else -%}
            {{ 'products.product.add_to_cart' | t }}
          {%- endif -%}
        {% endunless %}
      </span>
    </button>
  </div>
</div>
